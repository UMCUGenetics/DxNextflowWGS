params {
    genome = '/hpc/diaggen/data/databases/ref_genomes/Homo_sapiens.GRCh37.GATK.illumina/Homo_sapiens.GRCh37.GATK.illumina.fasta'
    dxtracks_path = '/hpc/diaggen/software/production/Dx_tracks'

    gatk_path = '/hpc/local/CentOS7/cog_bioinf/GenomeAnalysisTK-3.8-1-0-gf15c1c3ef/GenomeAnalysisTK.jar'
    gatk_bqsr_options = '--knownSites /hpc/diaggen/data/databases/GATK_resource_bundle/b37/1000G_phase1.indels.b37.vcf.gz --knownSites /hpc/diaggen/data/databases/GATK_resource_bundle/b37/dbsnp_137.b37.vcf.gz --knownSites /hpc/diaggen/data/databases/GATK_resource_bundle/b37/Mills_and_1000G_gold_standard.indels.b37.vcf.gz'
    fingerprint_target = 'fingerprint/81SNP_design.vcf'

    gatk_hc_interval_list = '/hpc/diaggen/projects/nextflow_wgs/Homo_sapiens.GRCh37.GATK.illumina.interval_list'
    gatk_hc_options = '-stand_call_conf 10 -GQB 1 -GQB 2 -GQB 3 -GQB 4 -GQB 5 -GQB 6 -GQB 7 -GQB 8 -GQB 9 -GQB 10 -GQB 11 -GQB 12 -GQB 13 -GQB 14 -GQB 15 -GQB 16 -GQB 17 -GQB 18 -GQB 19 -GQB 20 -GQB 21 -GQB 22 -GQB 23 -GQB 24 -GQB 25 -GQB 26 -GQB 27 -GQB 28 -GQB 29 -GQB 30 -GQB 31 -GQB 32 -GQB 33 -GQB 34 -GQB 35 -GQB 36 -GQB 37 -GQB 38 -GQB 39 -GQB 40 -GQB 41 -GQB 42 -GQB 43 -GQB 44 -GQB 45 -GQB 46 -GQB 47 -GQB 48 -GQB 49 -GQB 50 -GQB 51 -GQB 52 -GQB 53 -GQB 54 -GQB 55 -GQB 56 -GQB 57 -GQB 58 -GQB 59 -GQB 60 -GQB 70 -GQB 80 -GQB 90 -GQB 99'
    gatk_ggvcf_options = '--dbsnp /hpc/diaggen/data/databases/GATK_resource_bundle/b37/dbsnp_137.b37.vcf.gz'

    exoncov_path = '/hpc/diaggen/software/development/ExonCov'
    exoncov_bed = 'Tracks/ENSEMBL_UCSC_merged_collapsed_sorted_v3_20bpflank.bed'

    cluster_options = "--account=diaggen"
}

process {
    withLabel: BWA_0_7_17_MEM {
        cpus = 20
        memory = '32G'
        time = '18h'
    }

    withLabel: Sambamba_0_7_0_ViewSort {
        cpus = 10
        memory = '50G'
        time = '2h'
        clusterOptions = "$params.cluster_options --gres=tmpspace:20G"
    }

    withLabel: Sambamba_0_7_0_MarkdupMerge {
        cpus = 10
        memory = '10G'
        time = '2h'
        clusterOptions = "$params.cluster_options --gres=tmpspace:20G"

        publishDir {
            path = "$params.outdir/bam_files"
            mode = 'copy'
        }
    }

    withLabel: GATK_3_8_1_0_gf15c1c3ef_BaseRecalibrator {
        cpus = 4
        memory = '16G'
        time = '12h'
    }

    withLabel: Sambamba_0_7_0_ViewUnmapped {
        cpus = 2
        memory = '1G'
        time = '30m'
        clusterOptions = "$params.cluster_options --gres=tmpspace:10G"
    }

    withLabel: Sambamba_0_7_0_Merge {
        cpus = 10
        memory = '10G'
        time = '2h'
        clusterOptions = "$params.cluster_options --gres=tmpspace:10G"

        publishDir {
            path = "$params.outdir/bam_files"
            mode = 'copy'
        }
    }

    withLabel: PICARD_2_22_0_IntervalListTools {
        cpus = 2
        memory = '5G'
        time = '5m'
        clusterOptions = "$params.cluster_options --gres=tmpspace:10G"
    }

    withLabel: GATK_3_8_1_0_gf15c1c3ef_HaplotypeCallerGVCF {
        cpus = 2
        memory = '20G'
        time = '2h'
    }

    withLabel: GATK_3_8_1_0_gf15c1c3ef_CatVariantsGVCF {
        cpus = 2
        memory = '20G'
        time = '2h'

        publishDir {
            path = "$params.outdir/gvcf"
            mode = 'copy'
        }
    }

    withLabel: GATK_3_8_1_0_gf15c1c3ef_GenotypeGVCFs {
        cpus = 2
        memory = '20G'
        time = '2h'

        publishDir {
            path = "$params.outdir"
            mode = 'copy'
        }
    }

    withLabel: GATK_3_8_1_0_gf15c1c3ef_UnifiedGenotyper {
        cpus = 2
        memory = '5G'
        time = '5m'

        publishDir {
            path = "$params.outdir/fingerprint"
            mode = 'copy'
        }
    }

    withLabel: FASTQC_0_11_8 {
        cpus = 2
        memory = '1G'
        time = '40m'
        clusterOptions = "$params.cluster_options --gres=tmpspace:10G"

        publishDir {
            path = "$params.outdir/QC/FastQC"
            mode = 'copy'
        }
    }

    withLabel: VersionLog {
        cpus = 2
        memory = '5G'
        time = '10m'

        publishDir {
            path = "$params.outdir/log"
            mode = 'copy'
        }
    }
}

report {
    enabled = true
    file = "$params.outdir/log/nextflow_report.html"
}

trace {
    enabled = true
    file = "$params.outdir/log/nextflow_trace.txt"
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes,vol_ctxt,inv_ctxt'
}

timeline {
    enabled = true
    file = "$params.outdir/log/nextflow_timeline.html"
}

profiles {

    slurm {
        process {
            executor = 'slurm'
            queue = 'cpu'
            clusterOptions = "$params.cluster_options"

            errorStrategy = 'retry'
            maxRetries = 3
        }

        singularity {
            enabled = true
            runOptions = '-B /hpc:/hpc -B $TMPDIR:$TMPDIR'
            autoMounts = true
            cacheDir = '/hpc/diaggen/software/singularity_cache'
        }

        executor {
            queueSize = 1000
        }
    }

    mac {
        docker.enabled = true
        docker.runOptions = '-v /Users:/Users'
    }
}
